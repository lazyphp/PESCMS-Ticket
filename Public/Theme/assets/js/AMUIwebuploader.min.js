$(function(){$.webuploaderConfig=function(i){$.webuploader_for_amazeui=function(e){var l={compress:!1,fileVal:"upfile",auto:!0,duplicate:!0,server:i.server,gallery:!1,thumb:{type:""}},e=($.extend(l,e),window.devicePixelRatio||1),a=100*e,t=100*e,s=WebUploader.create(l);$(".am-btn").on("click",function(){s.upload()}),s.on("fileQueued",function(i){s.makeThumb(i,function(e,a){e="video"==l.type?'<div class="am-gallery-item webuploader-item am-img-thumbnail am-radius"><i class="am-video-camera am-icon-lg am-block"></i><div class="pes-upload-operate-video "></div><a href="javascript:;"><div class="pes-upload-operate am-hide"><i class="am-icon-trash"></i></div></a><h3 class="am-gallery-title am-text-center am-hide"></h3></div>':e?'<div class="am-gallery-item webuploader-item am-img-thumbnail am-radius"><a href="javascript:;" class="file-preview-other" ><i class="am-icon-file-o am-icon-lg am-block"></i><div class="pes-upload-operate am-hide"><i class="am-icon-trash"></i></div><h3 class="am-gallery-title am-text-center am-hide"></h3></a><div class="am-text-truncate am-text-xs file-preview-other-text am-text-center" >'+i.name+"</div> </div>":'<div class="am-gallery-item webuploader-item am-img-thumbnail am-radius"><a href="javascript:;" ><div class="pes-upload-operate am-hide"><i class="am-icon-search-plus"></i><i class="am-icon-trash"></i></div><img src="'+a+'"  alt="上次图片"/><h3 class="am-gallery-title am-text-center am-hide"></h3></a></div>';a='<li id="'+i.id+'" class="pes-upload-'+l.type+'">'+e+"</li>";1!=l.pick.multiple&&$("#before"+l.id).prevAll().remove(),$("#before"+l.id).before(a)},a,t)}),s.on("uploadProgress",function(e,a){$.AMUI.progress.start(a),$("#"+e.id+" h3.am-gallery-title").html('<i class="am-icon-spinner am-icon-spin"></i> 上传中...').removeClass("am-hide")}),s.on("uploadSuccess",function(e,a){if("SUCCESS"==a.state){switch(a.action){case"uploadfile":var i="[url="+a.url+"]"+a.original+"[/url]";break;case"uploadvideo":$("#"+e.id).find(".pes-upload-operate-video").html('<video controls ><source src="'+a.url+'" type="video/mp4"></video>');i=a.url;break;default:$("#"+e.id).find("img").attr("src",a.url);i=a.url}$("#"+e.id).append('<input type="hidden" name="'+l.name+'" value="'+i+'" autocomplete="off" >')}$("#"+e.id+" h3.am-gallery-title").html("SUCCESS"==a.state?"上传完成":a.state).removeClass("am-hide")}),s.on("uploadError",function(e,a){$("#"+e.id+" h3.am-gallery-title").html("上传失败 - 请求异常").removeClass("am-hide")}),s.on("uploadComplete",function(e){$("#"+e.id).find(".pes-upload-operate").removeClass("am-hide"),$.AMUI.progress.done()})},$("[data-am-webuploader-simple]").each(function(){var e,i=AMUI.utils.parseOptions($(this).attr("data-am-webuploader-simple"));$(this).html(AMUIwebuploader.template(i)),i.content&&($("#before"+i.id).prevAll().remove(),e=i.content.replace(/base64,/g,"{base64}"),$.each(e.split(","),function(e,a){a=a.replace(/\{base64\}/g,"base64,");AMUIwebuploader.append({id:i.id,src:a,name:i.name,type:i.type})})),$.webuploader_for_amazeui(i)}),$(document).on("click","[data-am-webuploader-simple] li .pes-upload-operate>.am-icon-trash",function(){var e=$(this).parents("li");e.attr("id").match("before")||e.remove()}),$(document).on("click","[data-am-webuploader-simple] li .pes-upload-operate>.am-icon-search-plus",function(){var e=$(this).parents("li").find("img").attr("src");$.fancybox.open({src:e,type:"image"})})}});var AMUIwebuploader={template:function(e){var a="file"==e.type?"upload_file_icon":"";return'<ul id="pes-upload-list-'+e.id+'" class="am-gallery am-avg-lg am-gallery-overlay am-webuploader-ul" ><li id="before'+e.id+'"><div class="am-gallery-item webuploader-item am-img-thumbnail am-radius webuploader-background-img"><a href="javascript:;" id="'+e.id+'" class="'+a+'"></a></div></li></ul>'},append:function(e){var a;a="file"==e.type?'<a href="javascript:;" class="file-preview-other" title="'+e.src+'"   ><i class="am-icon-file-o am-icon-lg am-block"></i><div class="pes-upload-operate"><i class="am-icon-trash"></i></div><h3 class="am-gallery-title am-text-center am-hide"></h3></a><div class="am-text-truncate am-text-xs file-preview-other-text am-text-center" >'+e.src+"</div>":"video"==e.type?'<i class="am-video-camera am-icon-lg am-block"></i><div class="pes-upload-operate-video "><video controls ><source src="'+e.src+'" type="video/mp4"></video></div><a href="javascript:;"><div class="pes-upload-operate"><i class="am-icon-trash"></i></div></a>':'<a href="javascript:;" ><img src="'+e.src+'"  alt="点击上传图片"/><div class="pes-upload-operate"><i class="am-icon-search-plus"></i><i class="am-icon-trash"></i></div><h3 class="am-gallery-title am-text-center am-hide"></h3></a>',$li='<div class="am-gallery-item webuploader-item am-img-thumbnail am-radius">'+a+"</div>",$li+='<input type="hidden" name="'+e.name+'" value="'+e.src+'" autocomplete="off">',$("#before"+e.id).before('<li id="'+Math.random()+'" class="pes-upload-'+e.type+'">'+$li+"</li>")},init:function(e,a){$("#"+e).html(this.template(a)),$.webuploader_for_amazeui(a)}};