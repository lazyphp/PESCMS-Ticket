$(function(){$.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今天",suffix:[],meridiem:["上午","下午"]},$("body").on("submit",".ajax-submit",function(){var t=$(this).attr("action"),e=$(this);return $.ajaxsubmit({url:t,data:e.serialize()},function(){}),!1}),$("body").on("click",".ajax-click",function(){var t,e=$(this).attr("href"),i=!1;if($(this).hasClass("am-disabled"))return!1;if($(this).hasClass("ajax-dialog")&&(t=$(this).attr("msg")?$(this).attr("msg"):"确定删除吗？",confirm(t)||(i=!0)),1==i)return!1;i=$('input[name="token"]').val();return $.ajaxsubmit({url:e,data:{token:i}},function(){}),!1}),$.ajaxsubmit=function(t,e){var a={url:"",data:{"":""},dialog:!0};$.extend(a,t);var i=$.AMUI.progress,r={id:"submit-tips",zIndex:"9999",fixed:!0,skin:"submit-warning"};i.start(),$.post(a.url,a.data,function(t){if(1==a.dialog){if(200==t.status){if(r.content='<i class="am-icon-check-circle"></i>  ',r.skin="submit-success",-1==t.waitSecond)return window.location.href=t.url,!1;setTimeout(function(){t.url?window.location.href=t.url:location.reload()},2e3)}else r.content='<i class="am-icon-exclamation-circle"></i>  ';r.content+=t.msg}$.refreshToken(t.token),e(t)},"JSON").fail(function(t,e,i){var n="系统请求出错！请再次提交!";try{switch($.refreshToken(t.responseJSON.token),t.status){case 500:case 404:n=t.responseJSON.msg;break;case 302:a.dialog=!1,dialog({title:"重定向提示",content:'<i class="am-icon-refresh am-icon-spin"></i> '+t.responseJSON.msg,skin:"submit-success",id:"redirectDialog",fixed:!0,okValue:"新窗口打开",ok:function(){return window.open(t.responseJSON.url),!1}}).showModal()}}catch(t){}r.skin="submit-error",r.content='<i class="am-icon-times-circle"></i> '+n}).complete(function(){var t,e;1==a.dialog&&(t=dialog(r).showModal(),e=$(".refresh-verify").attr("src"),$(".refresh-verify").attr("src",e+"&time="+Math.random()),setTimeout(function(){t.close().remove()},3e3)),i.done()})},$.refreshToken=function(t){$("input[name=token]").each(function(){$(this).val(t)})},$("body").on("blur",".icon-input",function(){var t=$(this).attr("name");$("."+t).attr("class",$(this).val()+" "+t)}),$(".color-input").spectrum({preferredFormat:"hex",showInput:!0}),$(".datetimepicker").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:00",maxView:"2",minView:"1",autoclose:!0}),$(document).on("click",".refresh-verify",function(){var t=$(this).attr("src");$(this).attr("src",t+"&time="+Math.random())}),$(".display-verify").on("click",function(){$(this).remove(),$(".refresh-verify").removeClass("am-hide").attr("src",PESCMS_PATH+"/?m=Index&a=verify&time="+Date.parse(new Date)+Math.random())}),$(".print-ticket").on("click",function(){var t=$(this).attr("href");return window.open(t,"","width=800,height=600"),!1}),$(".checkbox-all").on("click, change",function(){1==$(this).prop("checked")?$(".checkbox-all-children").prop("checked","checked"):$(".checkbox-all-children").removeAttr("checked")}),$(".delete-batch").on("click",function(){var t=$(this).attr("data"),e=$(".checkbox-all-children").serialize();if(!e)return alert("您没有勾选要删除的数据."),!1;if(confirm("确认进行批量删除所勾选数据吗？")){var i=$('input[name="token"]').val();return $.ajaxsubmit({url:t,data:e+"&token="+i},function(){}),!1}return!1})});